{% extends 'basePostList.html' %}
{% load static %}
{% load web_tags %}


{% block title %}
    Вопрос - Ответ
{% endblock %}

{% block extra_static %}
    <link rel="stylesheet" href="{% static 'web/css/question_answer.css' %}">
    <link rel="stylesheet" href="{% static 'web/css/article_list.css' %}">
    <link rel="stylesheet" href="{% static 'web/css/globalCSS.css' %}">
    <style>
        .search-and-cat-cont-mobile {
            display: flex;
            flex-direction: column;
        }

        .search-input-container {
            display: flex;
            width: 100%;
        }

        .button-filter-container {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }

        .ask-question-btn-mobile {
            text-wrap: nowrap !important;
        }

    </style>
{% endblock %}

{% block posts_content %}
    <div class="element-container main-list-gap">
        <div class="search-and-cat-cont d-none d-md-flex" >
            <div class="col-6">
                <input type="text" id="search-article-query" class="lists-search-cont" placeholder="Поиск">
            </div>
            <div class="col-6 d-flex justify-content-between pl-2">
                <a href="{% url 'wbqa:create_question' %}">
                    <button type="button" class="btn ask-question-btn btn-sm">Задать вопрос</button>
                </a>
                {% include "components/post_category_filter.html" %}
            </div>
        </div>

        <!-- Small Screens -->
        <div class="search-and-cat-cont d-md-none search-and-cat-cont-mobile">
            <div class="search-input-container">
                <input type="text" id="search-article-query" class="research-search-cont" placeholder="Поиск">
            </div>
            <div class="button-filter-container">
                <a href="{% url 'wbqa:create_question' %}">
                    <button type="button" class="btn ask-question-btn btn-sm ask-question-btn-mobile" style="margin-left: 0px !important;">Задать вопрос
                    </button>
                </a>
                {% include "components/post_category_filter.html" %}
            </div>
        </div>

        <div id="articles-container">
            {% include 'question_list_content.html' %}
        </div>

        {% if is_paginated %}
            <div id="load-more-container" class="text-center mt-4">
                <button id="load-more-btn" class="btn btn-secondary btn-more" data-page="{{ page_obj.number }}">Load More</button>
            </div>
        {% endif %}
    </div>

    <script>
    $(document).ready(function () {
        $("#search-article-query").keypress(function (event) {
            if (event.key === "Enter") {
                var search_value = $(this).val()
                if (search_value == '' || search_value == 'None')
                    return;
                window.location.href = "{{ request.path }}?search_q=" + search_value;
            }
        });

        $("#load-more-btn").click(function () {
            var button = $(this);
            var currentPage = parseInt(button.data('page'));
            var nextPage = currentPage + 1;

            var post_data = {
                'page': nextPage,
            }

            var search_q = '{{ search_q }}'

            if (search_q != '' && search_q != 'None') {
                post_data['search_q'] = search_q
            }
            $.ajax({
                url: '{{ request.path }}',
                data: post_data,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function (data) {
                    if (data.html) {
                        $("#articles-container").append(data.html);
                        button.data('page', nextPage);
                    }
                    if (!data.has_more) {
                        $("#load-more-container").hide();
                    }
                }
            });
        });
    });
</script>
{% endblock %}