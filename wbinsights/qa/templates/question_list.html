{% extends 'basePostList.html' %}

{% block title %}
    Вопрос - Ответ
{% endblock %}

{% load web_tags %}
{% load static %}


{% block posts_content %}


<style>
    .author-pic {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        overflow: hidden;
        border: 1px solid #ccc;
    }

    .author-pic img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    @media (max-width: 768px) {
        .article-list-search-cont {
            width: 100% !important;
        }

        .columnArticle {
            flex-direction: column;
        }
    }
</style>

{% block extra_static %}
    <link rel="stylesheet" href="{% static 'web/css/article_list.css' %}">
{% endblock %}


<body>

<div class="list-main-containers">

   <ul>
   {% for question in questions %}
       <li><a href="{% url 'qa:question_detail' question.pk %}">{{ question.title }}</a></li>
   {% empty %}
       <li>No questions available.</li>
   {% endfor %}
   </ul>
   {% if is_paginated %}
       <div class="pagination">
           {% if page_obj.has_previous %}
               <a href="?page=1">&laquo; first</a>
               <a href="?page={{ page_obj.previous_page_number }}">previous</a>
           {% endif %}
           <span class="current">
               Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
           </span>
           {% if page_obj.has_next %}
               <a href="?page={{ page_obj.next_page_number }}">next</a>
               <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
           {% endif %}
       </div>
   {% endif %}
   <a href="{% url 'qa:create_question' %}">Add Question</a>

</div>

<script>
$(document).ready(function() {
    $("#search-article-query").keypress(function(event) {
        if (event.key === "Enter") {
            var search_value = $(this).val()
            if (search_value == '' || search_value == 'None')
                return;
            window.location.href = "{{ request.path }}?search_q=" +  search_value;
        }
    });

    $("#load-more-btn").click(function() {
        var button = $(this);
        var currentPage = parseInt(button.data('page'));
        var nextPage = currentPage + 1;
        
        var post_data = {
            'page': nextPage,
        }
        
        var search_q = '{{ search_q }}'
        
        if (search_q != '' && search_q != 'None') {
            post_data['search_q'] = search_q
        }

        $.ajax({
            url: '{{ request.path }}',
            data: post_data,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            },
            success: function(data) {
                if (data.html) {
                    $("#articles-container").append(data.html);
                    button.data('page', nextPage);
                }
                if (!data.has_more) {
                    $("#load-more-container").hide();
                }
            }
        });
    });


});
</script>

</body>

{% endblock %}