{% extends 'base123.html' %}
{% load web_tags %}
{% load file_filters %}
{% block center_col %}
{% load static %}


<link rel="stylesheet" href="{% static 'css/editUserProject.css' %}">

<style>
    .select2-container {
      width: 100% !important;
    }

</style>


<h2>Редактирование проекта: {{ userproject.name }}</h2>

<form enctype="multipart/form-data" id="project-form" method="post">
    {% csrf_token %}
    <!--{{ form.as_p }}-->

    <div style="display:flex; flex-direction:column; gap:20px">

        {{form.name}}

        <select id="id_category" name="category" class="js-example-basic-single form-control" multiple="multiple">
            {% for value, label in form.category.field.choices %}
                <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
        </select>

        {{form.customer}}
        {{form.year}}
        {{form.goals}}
        {{form.key_results_text}}

    </div>



    <div id="members-container">
        <label for="search-experts">Search for an expert:</label>
        <select class="js-example-basic-single form-control"  id="search-experts"  ></select>
    </div>



<!--    <div id="members-container">-->
<!--        <label for="search-experts">Search for an expert:</label>-->
<!--        <select class="js-example-basic-single form-control"  name="state">-->
<!--            <option value="">Search for an expert...</option>-->
<!--            {% for member in userproject.members.all %}-->
<!--            <option value="{{ member.id }}">{{ member.get_full_name }}</option>-->
<!--            {% endfor %}-->
<!--        </select>-->
<!--    </div>-->


    <h3>Файлы проекта:</h3>
    <ul>
        {% for file in userproject.files.all %}
        <li>
            {% if file.file %}
            <a href="{{ file.file.url }}">{{ file.file.name|filename }}</a>
            {% else %}
            Файл отсутствует.
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    <p></p>
    <label for="id_file">Загрузить файл:</label>
    <input id="id_file" name="file_field_name" type="file">
    <p></p>

    <button type="submit"  class="btn btn-primary"> Сохранить изменения </button>
</form>

<script type="text/javascript">

    $(document).ready(function() {
        $('.js-example-basic-multiple').select2();
    });

    $(document).ready(function() {
      $('#id_category').select2();
    });


    $(document).ready(function() {
        $('#search-experts').select2({
            minimumInputLength: 0,
            dropdownParent: null,
            ajax: {
                url: "{% url 'search_experts' %}",
                dataType: 'json',
                delay: 250,
                processResults: function(data) {
                    return {
                        results: data.map(function(expert) {
                            return {
                                id: expert.id,
                                text: expert.first_name + ' ' + expert.last_name
                            };
                        })
                    };
                },
                cache: true,
                data: function(params) {
                    return {
                        query: params.term
                    };
                }
            },
            tags: true, // Allow user to input their own value
            createTag: function(params) {
                return {
                    id: params.term,
                    text: params.term,
                    newOption: true
                };
            }
        });
    });
</script>





{% endblock %}
