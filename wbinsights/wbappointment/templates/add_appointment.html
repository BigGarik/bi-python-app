{% extends 'base020.html' %}
{% load static %}
{% load i18n %}


{% block center_col %}

    <link rel="stylesheet" href="{% static 'css/add_appointment.css' %}">

    <link rel="stylesheet" href="{% static 'css/vanila-calendar/vanilla-calendar.min.css' %}"/>
    <script src="{% static 'js/vanila-calendar/vanilla-calendar.min.js' %}"></script>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <h2 class="text-center appointment-title">{% trans 'MakeAppointmentWithLabel' %} {{ expert.last_name }} {{ expert.first_name }}</h2>
                <div style="width:100%; display: flex; justify-content: flex-start; padding: 25px">
                    <div id="calendar" style="transform: scale(1.2); "></div>
                </div>
                <form method="post">
                    {% csrf_token %}
                    <div class="form-group appointment-margins">
{#                        <label for="{{ form.appointment_date.id_for_label }}" class="appointment-labels">Дата</label>#}
                        {{ form.appointment_date }}
                    </div>
                    <div class="form-group appointment-margins">
                        <label for="{{ form.appointment_time.id_for_label }}" class="appointment-labels">Время</label>
                        {{ form.appointment_time }}
                    </div>
                    <div class="form-group appointment-notes">
                        <label for="notes" class="appointment-labels">Additional Notes</label>
                        {{ form.notes }}
                    </div>


                    <button type="submit"
                            class="btn btn-primary btn-block appointment-btn">{% trans 'SubmitButtonLabel' %}</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {

            const options = {
                actions: {
                    clickDay(event, self) {
                        $('#id_appointment_date').val(self.selectedDates)

                        console.log(self.selectedDates)
                        const selectAppointmentTime = $('#id_appointment_time');
                        selectAppointmentTime.prop('disabled', false)

                        if (self.selectedDates.length > 0) {

                            //fetch available slots
                            //send request with two params
                            //1. selectedDate
                            //2. expertId
                            {##}
                            {#.then(function () {#}
                            {#    #}
                            {#\})#}

                            const availableSlots = {
                                slots: [
                                    '11:00',
                                    '13:00',
                                    '16:00',
                                    '17:00'
                                ]
                            }


                            selectAppointmentTime.html('')
                            availableSlots.slots.map( (slot) => {
                                selectAppointmentTime.append('<option value="' + slot + '">' + slot + '</option>')

                            })

                            selectAppointmentTime.prop('disabled', true)

                        }
                    },
                },
            };

            const calendar = new VanillaCalendar('#calendar',options);
            calendar.init();
        })


    </script>


{% endblock %}
