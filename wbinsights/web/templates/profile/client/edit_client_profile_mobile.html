{% extends 'base123.html' %}
{% load static %}
{% load i18n %}
{% load web_tags %}

{% block extra_static %}
<link rel="stylesheet" href="{% static 'web/css/profile_edit.css' %}">
<link rel="stylesheet" href="{% static 'web/css/edit_client_profile_mobile_css.css' %}">
{% endblock %}

{% block center_col %}


<div class="element-container">
        {% trans "BackButtonLabel" as back_text %}
        {% back_button "profile" back_text %}
        <div>
            <span class="prof-edit-page-title">Настройки профиля ({{ request.user.email }})</span>
        </div>

        {{ user_form.errors }}
        {{ profile_form.errors }}
        {{ expert_profile_form.errors }}

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="prof-edit-rows">
                <div class="prof-edit-duel-rows">
                    <div class="prof-edit-info-cont">
                        <label for="{{ user_form.first_name.id_for_label }}" class="prof-edit-input-labels">{{ user_form.first_name.label }}</label>
                        {{ user_form.first_name }}
                    </div>
                    <div class="prof-edit-info-cont">
                        <label for="{{ user_form.last_name.id_for_label }}" class="prof-edit-input-labels">{{ user_form.last_name.label }}</label>
                        {{ user_form.last_name }}
                    </div>
                </div>

                <div class="full-width">
                    <label for="{{ expert_profile_form.about.id_for_label }}" class="prof-edit-input-labels">{{ expert_profile_form.about.label }}</label>
                    {{ expert_profile_form.about }}
                </div>
            </div>

            <div class="expert-edit-rows">
                <div class="prof-edit-photo-cont">
                    <img src="{{ user.profile.avatar.url }}" alt="Avatar" class="avatar-img">
                    <div class="avatar-info">
                        {% if profile_form.instance.avatar %}
                            <p class="avatar-current-file">На данный момент: <a href="{{ profile_form.instance.avatar.url }}" class="avatar-current-link">{{ profile_form.instance.avatar.name }}</a></p>
                        {% endif %}
                        <label for="id_avatar">Изменить:</label>
                        <input type="file" name="avatar" class="smaller-letters" accept="image/*" id="id_avatar">
                    </div>
                </div>
            </div>

            <hr/>
            <div class="prof-edit-bot-btns-cont">
                <button type="submit" class="btn btn-secondary prof-edit-save-btn">Сохранить изменения</button>
                <button type="button" class="btn btn-secondary prof-edit-delete-btn" id="deleteProfileBtn" data-bs-toggle="modal" data-bs-target="#deleteProfileModal">
                    Удалить профиль
                </button>
            </div>
        </form>

        <div class="modal fade" tabindex="-1" role="dialog" id="deleteProfileModal">
            <div class="modal-dialog" role="document">
                <form method="post">
                    <div class="modal-content modal-custom">
                        <div class="modal-header modal-header-custom">
                            <h4 class="modal-title">Вы действительно хотите удалить профиль?</h4>
                        </div>
                        <div class="modal-body">
                            <p>После удаления вы не сможете восстановить данные</p>
                        </div>
                        <div class="modal-footer modal-footer-custom">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                            <button type="submit" class="btn btn-danger">Удалить</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
</div>

<script>
    // Скрипт для добавления новой формы образования
    $('.add-education-btn').click(function () {
        const newForm = $('.education-form:last').clone();
        newForm.find('input').val('');
        newForm.find('select').val('');
        const formRegex = RegExp('form-(\\d+)-', 'g');
        const formNum = parseInt($('#id_form-TOTAL_FORMS').val());
        newForm.html(newForm.html().replace(formRegex, 'form-' + formNum + '-'));
        $('#id_form-TOTAL_FORMS').val(formNum + 1);
        newForm.insertBefore($(this));
    });
</script>
{% endblock %}