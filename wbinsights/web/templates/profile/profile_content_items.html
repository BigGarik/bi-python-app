{% load web_tags %}
{% load static %}
{% load i18n %}



{%  block extra_static %}
    <link rel="stylesheet" href="{% static 'web/css/profile_content_itemsCSS.css' %}">
{% endblock %}



<!-- Desktop version -->
<div id="scrollable-tabs" class="scrollable-tabs-container">
    <ul class="nav nav-tabs nav-pills-scrollable d-none d-lg-flex nav-tabs-desktop">
        <li class="nav-item">
            <a href="?tab=articles" class="profile-menu-item nav-link {% if request.GET.tab == 'articles' or not request.GET.tab %}active{% endif %}">
                <span class="item-title">{% trans 'ArticlesTabLabel' %}&nbsp;</span>
                <span class="expert-profile-title-content-number">{{ experts_articles_count }}</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="?tab=researches" class="profile-menu-item nav-link {% if request.GET.tab == 'researches' %}active{% endif %}">
                <span class="item-title">{% trans 'ResearchesTabLabel' %}&nbsp;</span>
                <span class="expert-profile-title-content-number">0</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="?tab=questions" class="profile-menu-item nav-link {% if request.GET.tab == 'questions' %}active{% endif %}">
                <span class="item-title">{% trans 'QuestionsTabLabel' %}&nbsp;</span>
                <span class="expert-profile-title-content-number">{{ expert_questions_count }}</span>
            </a>
        </li>
        {% if request.path == '/profile' %}
        <li class="nav-item">
            <a href="?tab=consultations" class="profile-menu-item nav-link {% if request.GET.tab == 'consultations' %}active{% endif %}">
                <span class="item-title">{% trans 'ConsultationsTabLabel' %}&nbsp;</span>
                <span class="expert-profile-title-content-number">{{ users_appointment_cnt }}</span>
            </a>
        </li>
        {% endif  %}
        <li class="nav-item">
            <a href="?tab=reviews" class="profile-menu-item nav-link {% if request.GET.tab == 'reviews' %}active{% endif %}">
                <span class="item-title">{% trans 'ReviewsTabLabel' %}&nbsp;</span>
                <span class="expert-profile-title-content-number">0</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="?tab=projects" class="profile-menu-item nav-link {% if request.GET.tab == 'projects' %}active{% endif %}">
                <span class="item-title">{% trans 'ProjectsTabLabel' %}&nbsp;</span>
                <span class="expert-profile-title-content-number">{{ projects_count }}</span>
            </a>
        </li>
        {% if request.path == '/profile' %}
        <li class="nav-item">
            <a href="?tab=ratings" class="profile-menu-item nav-link {% if request.GET.tab == 'ratings' %}active{% endif %}">
                <span class="item-title">{% trans 'RatingsTabLabel' %}&nbsp;</span>
            </a>
        </li>
        {% endif %}
    </ul>
</div>

<!-- Mobile version -->
<div class="scrollable-tabs-container">
    <ul class="nav nav-pills d-lg-none nav-pills-scrollable nav-pills-mobile">
        <li class="nav-item">
            <a href="?tab=articles" id="articles-tab" class="nav-item-mobile profile-menu-item nav-link {% if request.GET.tab == 'articles' or not request.GET.tab %}active{% endif %}">
                <div class="mobile-prof-cont">
                    <span class="item-title">{% trans 'ArticlesTabLabel' %}&nbsp;</span>
                    <span class="expert-profile-title-content-number">{{ experts_articles_count }}</span>
                </div>
            </a>
        </li>
        <li class="nav-item">
            <a href="?tab=researches" id="researches-tab" class="nav-item-mobile profile-menu-item nav-link {% if request.GET.tab == 'researches' %}active{% endif %}">
                <div class="mobile-prof-cont">
                    <span class="item-title">{% trans 'ResearchesTabLabel' %}&nbsp;</span>
                    <span class="expert-profile-title-content-number">0</span>
                </div>
            </a>
        </li>
        <li class="nav-item">
            <a href="?tab=questions" id="questions-tab" class="nav-item-mobile profile-menu-item nav-link {% if request.GET.tab == 'questions' %}active{% endif %}">
                <div class="mobile-prof-cont">
                    <span class="item-title">{% trans 'QuestionsTabLabel' %}&nbsp;</span>
                    <span class="expert-profile-title-content-number">{{ expert_questions_count }}</span>
                </div>
            </a>
        </li>
        {% if request.path == '/profile' %}
        <li class="nav-item">
            <a href="?tab=consultations" id="consultations-tab" class="nav-item-mobile profile-menu-item nav-link {% if request.GET.tab == 'consultations' %}active{% endif %}">
                <div class="mobile-prof-cont">
                    <span class="item-title">{% trans 'ConsultationsTabLabel' %}&nbsp;</span>
                    <span class="expert-profile-title-content-number">{{ users_appointment_cnt }}</span>
                </div>
            </a>
        </li>
        {% endif %}
        <li class="nav-item">
            <a href="?tab=reviews" id="reviews-tab" class="nav-item-mobile profile-menu-item nav-link {% if request.GET.tab == 'reviews' %}active{% endif %}">
                <div class="mobile-prof-cont">
                    <span class="item-title">{% trans 'ReviewsTabLabel' %}&nbsp;</span>
                    <span class="expert-profile-title-content-number">0</span>
                </div>
            </a>
        </li>
        <li class="nav-item">
            <a href="?tab=projects" id="projects-tab" class="nav-item-mobile profile-menu-item nav-link {% if request.GET.tab == 'projects' %}active{% endif %}">
                <div class="mobile-prof-cont">
                    <span class="item-title">{% trans 'ProjectsTabLabel' %}&nbsp;</span>
                    <span class="expert-profile-title-content-number">{{ projects_count }}</span>
                </div>
            </a>
        </li>
        {% if request.path == '/profile' %}
        <li class="nav-item">
            <a href="?tab=ratings" id="ratings-tab" class="nav-item-mobile profile-menu-item nav-link {% if request.GET.tab == 'ratings' %}active{% endif %}">
                <div class="mobile-prof-cont">
                    <span class="item-title">{% trans 'RatingsTabLabel' %}</span>
                </div>
            </a>
        </li>
        {% endif %}
    </ul>
</div>



<div id="content-container">
    {% if request.GET.tab == "articles" or not request.GET.tab %}
        {% include 'posts/article/article-profile-list.html' with user=user %}
    {% elif request.GET.tab == "researches" %}
        {# researches_template #}
    {% elif request.GET.tab == "questions" %}
        {% include 'profile_question_list.html' with user=user %}
    {% elif request.GET.tab == "consultations"  and request.path == '/profile' %}
        <div id="consultations" class="expert-content">
            {% if is_mobile %}
                {% include 'components/appointment/calendar_mobile.html' %}
            {% else %}
                {% include 'components/appointment/calendar.html' %}
            {% endif %}
        </div>
    {% elif request.GET.tab == "reviews" %}
        {# reviews_template #}
    {% elif request.GET.tab == "projects" %}
        {% include 'project_list.html' with user=user %}
    {% elif request.GET.tab == "ratings" and request.path == '/profile' %}
        {% include 'profile/expert/rating_list.html' %}
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const slider = document.getElementById('scrollable-tabs');
    let isDown = false;
    let startX;
    let scrollLeft;

    slider.addEventListener('mousedown', (e) => {
        isDown = true;
        slider.style.cursor = 'grabbing';
        startX = e.pageX - slider.offsetLeft;
        scrollLeft = slider.scrollLeft;
        e.preventDefault(); //prevent dfault dragging behavior
    });

    slider.addEventListener('mouseleave', () => {
        isDown = false;
        slider.style.cursor = 'grab';
    });

    slider.addEventListener('mouseup', () => {
        isDown = false;
        slider.style.cursor = 'grab';
    });

    slider.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - slider.offsetLeft;
        const walk = (x - startX) * 2; //scroll seped
        slider.scrollLeft = scrollLeft - walk;
    });

    const links = slider.getElementsByTagName('a');
    for (let link of links) {
        link.addEventListener('mousedown', (e) => {
            e.preventDefault();
        });
        link.addEventListener('click', (e) => {
            if (isDown) {
                e.preventDefault();
            }
        });
    }
});
</script>

<script>
   document.addEventListener('DOMContentLoaded', function() {
    function scrollToActiveTab() {
        console.log("Attempting to scroll to active tab");

        {#const activeDesktopTab = document.querySelector('.nav-tabs-desktop .nav-link.active');#}
        {#if (activeDesktopTab) {#}
        {#    console.log("Found active desktop tab:", activeDesktopTab);#}
        {#    activeDesktopTab.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });#}
        {#} else {#}
        {#    console.log("No active desktop tab found");#}
        {#}#}

        const activeMobileTab = document.querySelector('.nav-pills-mobile .nav-link.active');
        if (activeMobileTab) {
            console.log("Found active mobile tab:", activeMobileTab);
            activeMobileTab.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        } else {
            console.log("No active mobile tab found");
        }
    }

    setTimeout(scrollToActiveTab, 100);

    let resizeTimer;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(scrollToActiveTab, 100);
    });

    setTimeout(scrollToActiveTab, 500);
});
</script>


