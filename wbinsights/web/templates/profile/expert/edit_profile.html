{% extends 'base120.html' %}
{% load static %}


{% block center_col %}

    <style>

        @media (max-width: 1400px ) {

            .prof-edit-input-title {
                min-height: 100px !important;
                justify-content: space-between !important;
            }


        }

    </style>

    <link rel="stylesheet" href="{% static 'web/css/profile_edit.css' %}">

    <div class="list-main-containers" style="padding:20px; margin-top:0px;">

        <div class="edit-prof-info-cont">

            <a href="{% url 'profile' %}" class="global-back-btn">
                <i class="bi bi-chevron-left" style="font-weight: bold; color:#777786;"></i> Назад
            </a>

            <div>
                <span class="prof-edit-page-title">Настройки профиля ({{ request.user.email }})</span>
                <span class="prof-edit-page-title1"><a href="">Расписание</a></span>
            </div>

            {{ user_form.errors }}
            {{ profile_form.errors }}
            {{ expert_profile_form.errors }}

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="prof-edit-rows">

                    <div class="prof-edit-duel-rows">

                        <div class="prof-edit-info-cont">
                            <label for="{{ user_form.first_name.id_for_label }}"
                                   class="prof-edit-input-labels">{{ user_form.first_name.label }}</label>
                            {{ user_form.first_name }}
                        </div>

                        <div class="prof-edit-info-cont">
                            <label for="{{ user_form.last_name.id_for_label }}"
                                   class="prof-edit-input-labels"> {{ user_form.last_name.label }}</label>
                            {{ user_form.last_name }}
                        </div>

                    </div>

                    <div class="full-width">
                        <label for="{{ expert_profile_form.about.id_for_label }}"
                               class="prof-edit-input-labels">{{ expert_profile_form.about.label }}</label>
                        {{ expert_profile_form.about }}
                    </div>

                </div>

                <style>
                    label[for="id_avatar"] {
                        display: none;
                    }
                </style>
                <div class="expert-edit-rows">

                    <div class="prof-edit-photo-cont">
                        <img src="{{ request.user.profile.avatar.url }}" alt="Avatar"
                             style="border-radius: 50%;max-height: 100px;max-width: 100px;min-width: 100px;min-height: 100px;object-fit: cover;">

                        <div style="display:flex ; margin-left: 10px ; flex-direction:column">
                            {% if profile_form.instance.avatar %}
                                <p style="color:white ; user-select: none; margin: 0;">На данный момент: <a
                                        href="{{ profile_form.instance.avatar.url }}"
                                        style="color: white;">{{ profile_form.instance.avatar.name }}</a></p>
                            {% endif %}

                            <label for="id_avatar">Изменить:</label>
                            <input type="file" name="avatar" class="your-custom-class" accept="image/*" id="id_avatar">
                        </div>
                    </div>


                    <div class="prof-edit-duel-rows">

                        <div class="prof-edit-input-title">
                            <label for="{{ expert_profile_form.expert_categories.id_for_label }}"
                                   class="prof-edit-input-labels">{{ expert_profile_form.expert_categories.label }}</label>
                            {{ expert_profile_form.expert_categories }}
                        </div>

                        <div class="prof-edit-input-title">
                            <label for="{{ expert_profile_form.experience.id_for_label }}"
                                   class="prof-edit-input-labels">{{ expert_profile_form.experience.label }}</label>
                            {{ expert_profile_form.experience }}
                        </div>

                        <div class="prof-edit-input-title">
                            <label for="{{ expert_profile_form.hour_cost.id_for_label }}"
                                   class="prof-edit-input-labels">{{ expert_profile_form.hour_cost.label }}</label>
                            {{ expert_profile_form.hour_cost }}
                        </div>

                    </div>

                </div>

                <div class="expert-edit-rows">

                    <div class="prof-edit-duel-rows">

                        <div class="prof-edit-info-cont">
                            <label for="{{ expert_profile_form.education.id_for_label }}"
                                   class="prof-edit-input-labels">{{ expert_profile_form.education.label }}</label>
                            {{ expert_profile_form.education }}
                        </div>

                        <div class="prof-edit-info-cont">
                            <label for="{{ expert_profile_form.age.id_for_label }}"
                                   class="prof-edit-input-labels">{{ expert_profile_form.age.label }}</label>
                            {{ expert_profile_form.age }}
                        </div>

                    </div>

                </div>
                <!-- Добавляем формсет для образования -->
                <div class="education-formset-container">
                    <span class="prof-edit-page-title">Образование</span>
                    {{ education_expert_formset.management_form }}
                    {% for form in education_expert_formset %}
                        <div class="education-form">
                            {{ form.errors }}
                            <div class="prof-edit-duel-rows">
                                <div class="prof-edit-input-title">
                                    <label for="{{ form.education_type.id_for_label }}" class="prof-edit-input-labels">{{ form.education_type.label }}</label>
                                    {{ form.education_type }}
                                </div>
                                <div class="prof-edit-input-title">
                                    <label for="{{ form.specialized_education.id_for_label }}" class="prof-edit-input-labels">{{ form.specialized_education.label }}</label>
                                    {{ form.specialized_education }}
                                </div>
                                <div class="prof-edit-input-title">
                                    <label for="{{ form.educational_institution.id_for_label }}" class="prof-edit-input-labels">{{ form.educational_institution.label }}</label>
                                    {{ form.educational_institution }}
                                </div>
                                <div class="prof-edit-input-title">
                                    <label for="{{ form.diploma_number.id_for_label }}" class="prof-edit-input-labels">{{ form.diploma_number.label }}</label>
                                    {{ form.diploma_number }}
                                </div>
                                <!-- Добавьте остальные поля формы здесь -->
                            </div>
                        </div>
                    {% endfor %}
                    <!-- Кнопка для добавления нового образования (если требуется) -->
                    <button type="button" class="btn btn-secondary add-education-btn">Добавить образование</button>
                </div>
                <script>
                    // Скрипт для добавления новой формы образования (если требуется)
                    $('.add-education-btn').click(function() {
                        // Клонируем последнюю форму в формсете
                        var newForm = $('.education-form:last').clone();
                        // Очищаем значения в клонированной форме
                        newForm.find('input').val('');
                        newForm.find('select').val('');
                        // Изменяем индекс в именах и id полей
                        var formRegex = RegExp('form-(\\d+)-', 'g');
                        var formNum = parseInt($('#id_form-TOTAL_FORMS').val());
                        newForm.html(newForm.html().replace(formRegex, 'form-' + formNum + '-'));
                        // Увеличиваем общее количество форм в управляющей форме
                        $('#id_form-TOTAL_FORMS').val(formNum + 1);
                        // Добавляем новую форму в DOM
                        newForm.insertBefore($(this));
                    });
                </script>

                <div class="expert-edit-rows">
                    <span class="prof-edit-change-pass">Смена пароля</span>
                    <br/>
                    <span class="prof-edit-change-pass" style="font-size: 14px">для смены заполните поля, в противном случае оставьте пустыми</span>


                    {% if user_change_password_form.errors %}
                        <div class="alert alert-danger">

                            {% for key, value  in user_change_password_form.errors.items %}
                                {{ value }}
                            {% endfor %}

                        </div>
                    {% endif %}

                    <div class="prof-edit-duel-rows">
                        <div class="prof-edit-input-title">
                            <label for="{{ user_change_password_form.old_password.id_for_label }}"
                                   class="prof-edit-input-labels">
                                {{ user_change_password_form.old_password.label }}</label>
                            {{ user_change_password_form.old_password }}
                        </div>
                        <div class="prof-edit-input-title">
                            <label for="{{ user_change_password_form.new_password1.id_for_label }}"
                                   class="prof-edit-input-labels">
                                {{ user_change_password_form.new_password1.label }}</label>
                            {{ user_change_password_form.new_password1 }}
                        </div>
                        <div class="prof-edit-input-title">
                            <label for="{{ user_change_password_form.new_password2.id_for_label }}"
                                   class="prof-edit-input-labels">
                                {{ user_change_password_form.new_password2.label }}</label>
                            {{ user_change_password_form.new_password2 }}
                        </div>
                    </div>

                    <script>
                        $(document).ready(function () {
                            $("[name=old_password]").val('')
                            $("[name=new_password1]").val('')
                            $("[name=new_password2]").val('')
                        })
                    </script>

                </div>

                <div class="prof-edit-bot-btns-cont">
                    <button type="submit" class="btn btn-secondary prof-edit-save-btn">Сохранить изменения</button>
                    <button type="button" class="btn btn-secondary prof-edit-delete-btn" id="deleteProfileBtn"
                            data-bs-toggle="modal" data-bs-target="#deleteProfileModal">
                        Удалить профиль
                    </button>
                </div>

            </form>

            <div class="modal fade" tabindex="-1" role="dialog" id="deleteProfileModal">

                <div class="modal-dialog" role="document">
                    <form method="post">

                        <div class="modal-content" style="width:400px !important">

                            <div class="modal-header" style="border-bottom: none;">
                                <h5 class="modal-title" style="border-bottom: none;font-weight: 400;font-size: 18px;">
                                    Удалить профиль</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                                        style="scale: 0.8;"></button>
                            </div>

                            <div class="modal-body" style="padding-top:0;padding-bottom: 0;">
                                <p style="font-weight: 600;">Для подтверждения введите пароль</p>
                            </div>

                            <div style="padding: var(--bs-modal-padding);padding-top: 0;">
                                <input type="password" required placeholder="Ваш пароль"
                                       style="width:100%;padding: 10px ;border-radius: 7px;border: 1px lightgrey solid; outline:none"/>
                            </div>

                            <div class="modal-footer"
                                 style="border-top: none;display: flex;justify-content: flex-start;">
                                <button type="submit" class="btn btn-danger"
                                        style="background-color: #f47070;border: none;">Удалить профиль
                                </button>
                                <button type="button" class="btn btn-secondary"
                                        style="background-color: white;border: 1px solid #a5b1c8;color: #36364b;"
                                        data-bs-dismiss="modal">Отмена
                                </button>
                            </div>
                        </div>
                    </form>

                </div>

            </div>

        </div>

    </div>
    <script>

        $(document).ready(function () {

            $("#id_expert_categories").select2();

        })

    </script>


{% endblock %}
