<script>


    let editor = null; // Global editor instance

    document.addEventListener('DOMContentLoaded', function () {
        // Initialize the editor
        editor = grapesjs.init({
            container: '#gjs',
            fromElement: true,
            height: 'auto',
            width: 'auto',
            storageManager: {
                type: 'local',
                autoload: false,
                autosave: true,
                stepsBeforeSave: 1,
                id: 'gjs',
            },
            plugins: ['grapesjs-plugin-i18n', 'grapesjs-touch', pixabayPlugin],
            pluginsOpts: {
                'grapesjs-plugin-i18n': {
                    messages: {
                        en: window.editorConfig.en,
                        ru: window.editorConfig.ru
                    },
                },
                [pixabayPlugin]: {
                    pixabayApiKey: '47178532-a86b4337223bb283742a46665',
                }
            },
            panels: {defaults: []},
            blockManager: {
                appendTo: '#blocks',
                blocks: [
                    // ... your existing blocks ...
                ]
            },
            styleManager: {
                appendTo: '#style-manager-container',
                sectors: [
                    {
                        name: 'Typography',
                        open: true,
                        buildProps: ['font-family', 'font-size', 'font-weight', 'line-height', 'letter-spacing', 'color'],
                    },
                    {
                        name: 'Alignment',
                        open: false,
                        buildProps: ['text-align'],
                    },
                ]
            }
        });

        // Editor load event
        editor.on('load', () => {
            const gjsContainer = document.getElementById('gjs');
            if (gjsContainer) {
                gjsContainer.style.overflow = 'visible';
                gjsContainer.style.height = '100%';
                gjsContainer.style.minHeight = '1000px';
            }

            const wrapper = editor.getWrapper();
            if (wrapper) {
                wrapper.setStyle({
                    padding: '15px'
                });
            }

            // Set initial content if exists
            const contentInput = document.querySelector('input[name=content]');
            const stylesInput = document.querySelector('input[name=styles]');

            if (contentInput && contentInput.value) {
                editor.setComponents(contentInput.value);
            }
            if (stylesInput && stylesInput.value) {
                editor.setStyle(stylesInput.value);
            }
        });

        // Register components after editor initialization
        editor.DomComponents.addType('pixabay-image', {
            isComponent: (el) => el.getAttribute && el.getAttribute('data-pixabay-id'),
            model: {
                defaults: {
                    ...editor.DomComponents.getType('image').model.prototype.defaults,
                    droppable: false,
                    traits: [
                        {
                            type: 'button',
                            label: 'Browse Pixabay',
                            name: 'pixabay-browse',
                            text: 'Browse Images',
                            command: 'open-pixabay-modal'
                        }
                    ]
                }
            }
        });
    });
</script>